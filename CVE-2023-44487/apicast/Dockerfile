FROM registry-proxy.engineering.redhat.com/rh-osbs/3scale-amp2-apicast-gateway-rhel8:3scale-2.13-rhel-8-candidate-25648-20231030084123
#FROM registry.redhat.io/3scale-amp2/apicast-gateway-rhel8:3scale2.13

USER root

RUN dnf install -y 'patch'

COPY http2_max_concurrent_streams.diff.patch /tmp
COPY lua_check_client_abort.diff.patch /tmp

RUN cd /opt/app-root/src && \
  patch -p2 < /tmp/http2_max_concurrent_streams.diff.patch && \
  patch -p2 < /tmp/lua_check_client_abort.diff.patch

USER default
